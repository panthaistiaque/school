<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>||New User Request||</title>
    <span th:include="fragment/header::headerPortion" th:remove="tag"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <span th:include="fragment/nevigation::nivbarPortion" th:remove="tag"/>
    <!-- Left side column. contains the logo and sidebar -->
    <span th:include="fragment/menu::menuPortion" th:remove="tag"/>

    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Blank page
                <small>it all starts here</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                <li><a href="#">Examples</a></li>
                <li class="active">Blank page</li>
            </ol>
        </section>

        <!-- Main content -->
        <section class="content">

            <!-- Default box -->
            <div class="box">
                <div class="box-header with-border">
                    <h3 class="box-title">Title</h3>

                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip"
                                title="Collapse">
                            <i class="fa fa-minus"></i></button>
                        <button type="button" class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip"
                                title="Remove">
                            <i class="fa fa-times"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <table id="example2" class="table table-responsive no-margin">
                        <thead>
                        <tr>
                            <th>Request ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Date of Birth</th>
                            <th>Status</th>
                            <th>Phone No</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <span th:each="userObj : ${requestedUserList}" th:remove="tag">
                                <tr>
                                    <td> <a th:data="${userObj.requestId}" class="reqid" href="#"><u><span
                                            th:text="${userObj.requestId}"></span></u></a></td>
                                    <td th:text="${userObj.fullName}"></td>
                                    <td th:text="${userObj.email}">Email</td>
                                    <td th:text="${userObj.dob}">Date of Birth</td>
                                    <td>
                                        <span th:switch="${userObj.status.toString()}" th:remove="tag">
                                            <span class="label label-success" th:case="'APPROVED'"
                                                  th:text="${userObj.status}"></span>
                                            <span class="label label-danger" th:case="'REJECTED'"
                                                  th:text="${userObj.status}"></span>
                                            <span class="label label-warning" th:case="'PENDING'"
                                                  th:text="${userObj.status}"></span>
                                        </span>
                                    </td>
                                    <td th:text="${userObj.phone}">Phone No</td>
                                    <td>
                                        <span th:switch="${userObj.status.toString()}" th:remove="tag">
                                            <button class="btn btn-primary btn-xs btnActionForUserRequestApprove"
                                                    th:id="${userObj.requestId}" th:case="'PENDING'">Action</button>
                                            <button class="btn btn-primary btn-xs btnActionForUserRequestApprove"
                                                    th:id="${userObj.requestId}" th:case="*" disabled>Action</button>
                                        </span>
                                        </td>
                                </tr>
                            </span>
                        </tbody>
                    </table>
                </div>
                <!-- /.box-body -->
                <!--<div class="box-footer">-->
                <!--Footer-->
                <!--</div>-->
                <!--===================================================-->
                <div class="modal  fade" tabindex="-1" role="dialog"
                     aria-hidden="true" id="reqDetails">
                    <div class="modal-dialog ">
                        <div class="panel panel-success">
                            <div class="panel-heading">Request Details
                                <span class="label label-lg pull-right" id="userRequestDetailsStatus">PANDING</span>
                            </div>
                            <div class="panel-body">
                                <ul class="nav nav-tabs">
                                    <li class="active"><a data-toggle="tab" href="#home">Details</a></li>
                                    <li><a data-toggle="tab" href="#menu1">PC Info</a></li>
                                    <li><a data-toggle="tab" href="#menu2">Admin Use</a></li>
                                </ul>

                                <div class="tab-content">
                                    <div id="home" class="tab-pane fade in active">
                                        <h3>Personal</h3>
                                        <p>
                                        <table class="table">
                                            <tr>
                                                <td>Request ID</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="personalUserRequestId"/></td>
                                            </tr>
                                            <tr>
                                                <td>Name</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="personalUserRequestName"/></td>
                                            </tr>
                                            <tr>
                                                <td>E-mail</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="personalUserRequestEmail"/></td>
                                            </tr>
                                            <tr>
                                                <td>Date of birth</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="personalUserRequestdob"/></td>
                                            </tr>
                                            <tr>
                                                <td>Phone</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="personalUserRequestPhone"/></td>
                                            </tr>
                                        </table>
                                        </p>
                                    </div>
                                    <div id="menu1" class="tab-pane fade">
                                        <h3>Browser Info</h3>
                                        <p>
                                        <table class="table table-responsive table-striped">
                                            <tr>
                                                <td>Browser Registration No</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="browserrid"/></td>
                                            </tr>
                                            <tr>
                                                <td>Browser Name</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="browserName"/></td>
                                            </tr>
                                            <tr>
                                                <td>OS Name</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="clientOsName"/></td>
                                            </tr>
                                            <tr>
                                                <td>Client IP</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="browserclientIp"/></td>
                                            </tr>
                                            <tr>
                                                <td>User Agent</td>
                                                <td><input readonly style="width: 100%;padding: 5px 20px;"
                                                           id="browserUserAgent"/></td>
                                            </tr>
                                        </table>
                                        </p>
                                    </div>
                                    <div id="menu2" class="tab-pane fade">
                                        <h3>Admin Works</h3>
                                        <table class="table table-responsive">
                                            <tr>
                                                <td> Request Date</td>
                                                <td><input id="userRequestEntryDate"
                                                           style="width: 100%;padding: 5px 20px;" readonly/></td>
                                            </tr>
                                            <tr>
                                                <td>Review Date</td>
                                                <td><input id="userRequestReviewDate"
                                                           style="width: 100%;padding: 5px 20px;" readonly/></td>
                                            </tr>
                                            <tr th:rowspan="3">
                                                <td>Admin Commant</td>
                                                <td><textarea style="width: 100%; height:100%; padding: 5px 20px;"
                                                              readonly id="requestRejectionMessage"></textarea></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <div class="pull-right">
                                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">ok</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--===================================================-->
                <!--=================Admin Action modal==================================-->
                <div class="modal  fade" tabindex="-1" role="dialog"
                     aria-hidden="true" id="actionForUserRequestApproveModal">
                    <div class="modal-dialog ">
                        <div class="panel panel-success">
                            <div class="panel-heading">User Approval
                                <span class="label label-lg label-warning pull-right">PANDING</span>
                            </div>
                            <div class="panel-body">
                                <form th:method="POST" th:action="@{/userRequestAccept}">
                                    <div id="actionForUserRequestApproveModalDetails"></div>
                                    <input type="submit"/>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!--=================Admin Action [end]==================================-->
                <!-- /.box-footer-->
            </div>
            <!-- /.box -->

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Version</b> 2.4.18
        </div>
        <strong>Copyright &copy; 2014-2019 <a href="https://adminlte.io">AdminLTE</a>.</strong> All rights
        reserved.
    </footer>

    <!-- Control Sidebar -->
    <span th:include="fragment/configuration::configPortion" th:remove="tag"/>
    <!-- /.control-sidebar -->

</div>
<!-- ./wrapper -->

<span th:include="fragment/jsRef::jsRefPortion" th:remove="tag"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script>
    $(document).ready(function () {
        $('.sidebar-menu').tree();
        $('.reqid').on('click', function (e) {
            var recipient = $(this).attr('data');
            $.get('getOneNewRequestUser/' + recipient,  // url
                    function (data, textStatus, jqXHR) {  // success callback
                        $("#personalUserRequestId").val(data.requestId);
                        $("#personalUserRequestName").val(data.fullName);
                        $("#personalUserRequestEmail").val(data.email);
                        $("#personalUserRequestPhone").val(data.phone);
                        $("#personalUserRequestdob").val(data.dob);
                        $("#userRequestDetailsStatus").text(data.status);
                        $("#userRequestEntryDate").val(data.requstDate);
                        $("#userRequestReviewDate").val(data.actionDate);
                        if (data.status == 'PENDING') {
                            $("#userRequestDetailsStatus").addClass('label-warning');
                            $("#userRequestDetailsStatus").removeClass('label-danger');
                            $("#userRequestDetailsStatus").removeClass('label-success');
                        } else if (data.status == 'REJECTED') {
                            $("#userRequestDetailsStatus").removeClass('label-warning');
                            $("#userRequestDetailsStatus").addClass('label-danger');
                            $("#userRequestDetailsStatus").removeClass('label-success');
                        } else if (data.status == 'APPROVED') {
                            $("#userRequestDetailsStatus").removeClass('label-warning');
                            $("#userRequestDetailsStatus").removeClass('label-danger');
                            $("#userRequestDetailsStatus").addClass('label-success');
                        }
                        ajaxCall2(data.bid);//requestRejectionMessage
                        ajaxCall3(data.requestId);
                        $('#reqDetails').modal('show');
                    });


        });
        function ajaxCall3(id) {
            var i = Number(id);
            debugger;
            $.get('v1/rejectionMessage/' + i,
                    function (data) {
                        $("#requestRejectionMessage").val(data.comment);
                    }
            );
        }

        function ajaxCall2(id) {
            $.get('getBrowserForUser/' + id,
                    function (data, textStatus, jqXHR) {
                        $("#browserrid").val((data.registrationNo).substring(0, 26) + '...');
                        $("#browserName").val(data.clientBrowser);
                        $("#clientOsName").val(data.clientOS);
                        $("#browserclientIp").val(data.clientIpAddress);
                        $("#browserUserAgent").val(data.userAgent);
                    }
            )
        };
        $('.btnActionForUserRequestApprove').on('click', function (e) {
            var recipient = $(this).attr('id');
            $.get('getOneNewRequestUser/' + recipient,  // url
                    function (data, textStatus, jqXHR) {  // success callback
                        var cusHtml = "";
                        var sta = "";
                        if (data.status == 'PENDING') {
                            sta = "<option  value='APPROVED'>APPROVED</option>" +
                                    "<option  value='REJECTED'>REJECTED</option>" +
                                    "<option selected disabled>PENDING</option>";
                        } else if (data.status == 'REJECTED') {
                            sta = "<option  value='APPROVED'>APPROVED</option>" +
                                    "<option selected value='REJECTED'>REJECTED</option>" +
                                    "<option disabled>PENDING</option>";
                        }
                        cusHtml += "<table class='table table-hover'>" +
                                "<tr>" +
                                "<td>Request ID</td>" +
                                "<td><input name='requId' readonly style='width: 100%;padding: 5px 20px;' value='" + data.requestId + "'/></td>" +
                                "</tr>" +
                                "<tr>" +
                                "<td>Full Name</td>" +
                                "<td><input readonly style='width: 100%;padding: 5px 20px;' value='" + data.fullName + "'/></td>" +
                                "</tr>" +
                                "<tr>" +
                                "<td>User Status*</td>" +
                                "<td><select required name='requStatus' class='browser-default' style='width: 100%;padding: 5px 20px;'>" + sta +
                                "</select></td>" +
                                "</tr>" +
                                "</table>";
                        $("#actionForUserRequestApproveModalDetails").html(cusHtml);
                    });
            $('#actionForUserRequestApproveModal').modal('show');
        });
    })
</script>
<script type="text/javascript" th:inline="javascript">
    $(function () {
        /*<![CDATA[*/
        var mess = /*[[${mess}]]*/;
        var err = /*[[${err}]]*/;
        if (mess != null && mess.length > 5) {
            if(err!=null){
                toastr.options.positionClass = 'toast-top-center';
                toastr.warning(mess);
            }else {
                toastr.options.positionClass = 'toast-top-center';
                toastr.success(mess);
            }

        }
//        var message = /*[[${message}]]*/;
//        if (message != null && message.length > 5) {
//            toastr.options.positionClass = 'toast-top-center';
//            toastr.success(message);
//        }
    });
    /*]]>*/
</script>
</body>
</html>
